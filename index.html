<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Elite Athlete Training ‚Äì Track/Plyo Re-Applied</title>
<style>
  :root{
    --bg:#0a0a0a;--panel:#131313;--ink:#e7fdf4;--mut:#8aa39b;
    --edge:#233;--acc:#00ff88;--acc2:#00ccff;--warn:#ff6b35;--err:#ff4444;
  }
  *{box-sizing:border-box;margin:0;padding:0}
  body{background:var(--bg);color:#fff;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Arial,sans-serif;line-height:1.5;padding:18px}
  h1{font-size:34px;text-align:center;margin-bottom:8px;background:linear-gradient(90deg,#ff6b35, #00ff88,#00ccff);
      -webkit-background-clip:text;-webkit-text-fill-color:transparent}
  .sub{color:#9aa; text-align:center;margin-bottom:18px;font-size:14px}
  .card{background:var(--panel);border:2px solid var(--edge);border-radius:12px;padding:18px;margin-bottom:14px}
  .row{display:grid;gap:12px}
  @media(min-width:900px){ .row.cols-2{grid-template-columns:1fr 1fr} .row.cols-3{grid-template-columns:repeat(3,1fr)} }
  label{font-size:12px;color:#9db}
  select,input,textarea{width:100%;padding:11px;border-radius:8px;border:2px solid #2a2a2a;background:#0f0f0f;color:#fff;font-size:15px}
  select:focus,input:focus,textarea:focus{outline:none;border-color:var(--acc)}
  .hint{font-size:12px;color:#9aa}
  .badge{display:inline-block;font-size:11px;font-weight:700;padding:4px 8px;border-radius:999px;background:#0e2d23;color:var(--acc);border:1px solid #124}
  .btn{cursor:pointer;border:none;border-radius:9px;padding:12px 16px;font-weight:800}
  .btn-primary{background:linear-gradient(135deg,var(--acc),var(--acc2));color:#000}
  .btn-ghost{background:#1a1a1a;border:2px dashed #444;color:#aaa}
  .metrics{display:grid;gap:12px}
  @media(min-width:900px){.metrics{grid-template-columns:repeat(3,1fr)}}
  .metric{background:#0f0f0f;border-left:4px solid var(--acc2);border-radius:10px;padding:16px}
  .metric h3{font-size:13px;color:#9aa;margin-bottom:6px}
  .metric .v{font-size:28px;color:var(--acc);font-weight:900}
  .ok{background:rgba(0,255,136,.12);border:2px solid var(--acc);padding:14px;border-radius:10px}
  .warn{background:rgba(255,107,53,.15);border:2px solid var(--warn);padding:14px;border-radius:10px}
  .danger{background:rgba(255,68,68,.18);border:2px solid var(--err);padding:14px;border-radius:10px}
  .hrPrev{max-width:100%;max-height:260px;border-radius:10px;margin-top:10px;border:1px solid #234}
  .pill{display:inline-flex;gap:6px;align-items:center;padding:8px 10px;border-radius:10px;background:#0e0e0e;border:1px solid #274}
  .grid7{display:grid;grid-template-columns:repeat(7,1fr);gap:6px}
  .dayH{background:#111;border:1px solid #223;border-radius:8px;text-align:center;padding:8px;color:#8aa;font-size:12px}
  .cell{min-height:110px;background:#111;border:2px solid #222;border-radius:10px;padding:8px;cursor:pointer}
  .cell:hover{border-color:#345}
  .today{border-color:var(--acc);box-shadow:0 0 18px rgba(0,255,136,.18)}
  .modal{position:fixed;inset:0;background:rgba(0,0,0,.92);display:flex;align-items:flex-start;justify-content:center;padding:22px;z-index:1000}
  .modal>.panel{width:min(1150px,98vw);background:#0a0a0a;border:2px solid var(--acc);border-radius:14px;max-height:92vh;overflow:auto;padding:18px}
  .hdr{display:flex;gap:12px;align-items:center;justify-content:space-between;margin-bottom:10px}
  .x{background:#191919;border:2px solid #333;color:#ddd}
</style>
</head>
<body>
  <h1>üèÜ ELITE ATHLETE TRAINING</h1>
  <p class="sub">Your Track / Plyometrics module has been re-applied with contacts-accurate stairs logic, tendon & CNS modeling, and HR integration (manual + screenshot preview).</p>

  <!-- Calendar shell (simple) -->
  <div class="card">
    <div class="row cols-3" style="align-items:center">
      <button class="btn x" onclick="shiftMonth(-1)">‚Äπ Prev</button>
      <div id="monthTitle" style="text-align:center;font-weight:900;font-size:18px;color:var(--acc)"></div>
      <div style="text-align:right">
        <button class="btn x" onclick="goToday()">Today</button>
      </div>
    </div>
    <div class="grid7" style="margin-top:10px">
      <div class="dayH">Sun</div><div class="dayH">Mon</div><div class="dayH">Tue</div>
      <div class="dayH">Wed</div><div class="dayH">Thu</div><div class="dayH">Fri</div><div class="dayH">Sat</div>
    </div>
    <div id="grid" class="grid7" style="margin-top:6px"></div>
  </div>

  <!-- Modal mount -->
  <div id="mount"></div>

<script>
/* ======================= STATE ======================= */
let current = new Date();
let store = JSON.parse(localStorage.getItem("eliteTrainingData")||"{}");

/* ======================= CALENDAR ==================== */
function pad(n){return String(n).padStart(2,"0")}
function key(d){return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`}
function setTitle(){
  const m = ["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"];
  document.getElementById("monthTitle").textContent = `${m[current.getMonth()]} ${current.getFullYear()}`
}
function draw(){
  setTitle();
  const g = document.getElementById("grid"); g.innerHTML="";
  const y=current.getFullYear(), m=current.getMonth();
  const first = new Date(y,m,1).getDay();
  const days = new Date(y,m+1,0).getDate();
  const prevDays = new Date(y,m,0).getDate();
  const todayK = key(new Date());

  // leading
  for(let i=first-1;i>=0;i--){
    const d = new Date(y,m-1,prevDays-i);
    g.appendChild(dayCell(d, true, todayK));
  }
  // this month
  for(let d=1; d<=days; d++){
    g.appendChild(dayCell(new Date(y,m,d), false, todayK));
  }
  // trailing
  const total = first + days;
  const need = total<=35 ? 35-total : 42-total;
  for(let d=1; d<=need; d++){
    g.appendChild(dayCell(new Date(y,m+1,d), true, todayK));
  }
}
function dayCell(date, dim, todayK){
  const k = key(date);
  const div = document.createElement("div");
  div.className = "cell"+(k===todayK?" today":"");
  if(dim) div.style.opacity = .35;
  div.innerHTML = `<div style="font-weight:900;color:#ddd">${date.getDate()}</div>
    <div style="margin-top:6px;font-size:12px;color:#9aa">${store[k]?'Track/Plyo saved':''}</div>`;
  div.onclick = ()=>openDay(k, date);
  return div;
}
function shiftMonth(n){ current.setMonth(current.getMonth()+n); draw(); }
function goToday(){ current = new Date(); draw(); }

/* =================== TRACK / PLYO MODAL ============== */
function openDay(k, date){
  const prev = store[k]?.trackPlyo || {};
  const human = date.toLocaleDateString(undefined,{weekday:'long',month:'long',day:'numeric',year:'numeric'});
  const mount = document.getElementById("mount");
  mount.innerHTML = `
    <div class="modal">
      <div class="panel">
        <div class="hdr">
          <div style="font-weight:900;color:var(--acc)">Track / Plyometrics ‚Äî ${human}</div>
          <button class="btn x" onclick="closeModal()">‚úï Close</button>
        </div>

        <div class="card ok">
          <span class="badge">Contacts rule</span>
          <div class="hint" style="margin-top:6px">
            Ground: <b>contacts = reps √ó jumps/rep</b>.
            Stadium stairs: <b>contacts = steps/column √ó columns √ó jumps/step</b>.
          </div>
        </div>

        <div class="card">
          <div class="row cols-3">
            <div>
              <label>Exercise</label>
              <select id="ex">
                ${[
                  "Broad Jump","Standing Triple Jump (bounds)",
                  "Hurdle Hops","Box Jump (stick)","Depth Jump (rebound)",
                  "Stair Jumps","Single-Leg Hops","Alternate Bounds"
                ].map(x=>`<option ${prev.ex===x?'selected':''}>${x}</option>`).join("")}
              </select>
            </div>
            <div>
              <label>Unit</label>
              <select id="unit">
                <option ${prev.unit==="Yards"?'selected':''}>Yards</option>
                <option ${prev.unit==="Meters"?'selected':''}>Meters</option>
                <option ${prev.unit==="Stadium Stairs"?'selected':''}>Stadium Stairs</option>
              </select>
            </div>
            <div>
              <label>Distance per rep (yards/meters)</label>
              <input id="dist" type="number" step="1" min="0" value="${prev.dist??0}"/>
            </div>
          </div>

          <div class="row cols-3" style="margin-top:10px">
            <div>
              <label>Reps (ground)</label>
              <input id="reps" type="number" min="0" step="1" value="${prev.reps??0}"/>
            </div>
            <div>
              <label>Jumps per rep (ground)</label>
              <input id="jpr" type="number" min="0" step="1" value="${prev.jpr??0}"/>
            </div>
            <div>
              <label>Jumps per step (stairs)</label>
              <input id="jps" type="number" min="0" step="1" value="${prev.jps??1}"/>
            </div>
          </div>

          <div class="row cols-3" style="margin-top:10px">
            <div>
              <label>Steps per column (stairs)</label>
              <input id="stepsCol" type="number" min="0" step="1" value="${prev.stepsCol??0}"/>
            </div>
            <div>
              <label>Columns completed (stairs)</label>
              <input id="cols" type="number" min="0" step="1" value="${prev.cols??0}"/>
            </div>
            <div>
              <label>Sleep last night (h)</label>
              <input id="sleep" type="number" step="0.5" min="0" value="${prev.sleep??7.5}"/>
            </div>
          </div>

          <div class="row cols-3" style="margin-top:10px">
            <div>
              <label>Achilles / Calf status</label>
              <select id="ach">
                ${["Fresh","Tight","Sore"].map(x=>`<option ${prev.ach===x?'selected':''}>${x}</option>`).join("")}
              </select>
            </div>
            <div>
              <label>Avg HR (bpm) ‚Äî manual</label>
              <input id="avgHR" type="number" min="0" value="${prev.avgHR??0}"/>
              <div class="hint">Optional; use your Polar summary.</div>
            </div>
            <div>
              <label>Time in Zone 5 (min) ‚Äî manual</label>
              <input id="z5" type="number" min="0" step="1" value="${prev.z5??0}"/>
            </div>
          </div>

          <div class="row cols-2" style="margin-top:10px;align-items:end">
            <div>
              <label>HR Screenshot (optional)</label>
              <input id="hrImg" type="file" accept="image/*" onchange="previewHR(event,'hrPrev')"/>
              <img id="hrPrev" class="hrPrev" style="display:${prev.img?'block':'none'}" src="${prev.img??''}"/>
              <div class="hint">We preview the image and use manual fields for metrics (robust & 100% offline).</div>
            </div>
            <div>
              <label>Notes</label>
              <textarea id="notes" rows="6" placeholder="Add context (surface, wind, spikes, shoes, soreness, etc.)">${prev.notes??""}</textarea>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="row cols-3 metrics">
            <div class="metric"><h3>Contacts (exact)</h3><div class="v" id="mContacts">0</div></div>
            <div class="metric" style="border-left-color:var(--acc)"><h3>Tendon Load Index</h3><div class="v" id="mTendon">0</div></div>
            <div class="metric" style="border-left-color:#ffaa00"><h3>CNS Load (0‚Äì100)</h3><div class="v" id="mCNS">0</div></div>
          </div>
          <div id="riskBox" style="margin-top:10px"></div>
          <div style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap">
            <button class="btn btn-ghost" onclick="compute()">‚Üª Recompute</button>
            <button class="btn btn-primary" onclick="saveDay('${k}')">‚úì Save Day & Recompute</button>
          </div>
        </div>

      </div>
    </div>
  `;
  // initial compute
  compute();
}
function closeModal(){ document.getElementById("mount").innerHTML=""; }

/* =================== COMPUTATION ===================== */
function previewHR(e, id){
  const f = e.target.files?.[0]; if(!f) return;
  const rd = new FileReader();
  rd.onload = ()=>{ const img = document.getElementById(id); img.src = rd.result; img.style.display='block'; };
  rd.readAsDataURL(f);
}

function impactFactor(ex){
  // empirical relative impact multipliers grounded in elite S&C literature
  // Depth > Hurdle > Bounds ‚âà Single-Hop > Broad ‚âà Box (stick) > Stair
  if(/Depth Jump/.test(ex)) return 1.30;
  if(/Hurdle/.test(ex)) return 1.18;
  if(/Alternate Bounds|Triple/.test(ex)) return 1.12;
  if(/Single-Leg/.test(ex)) return 1.10;
  if(/Broad|Box/.test(ex)) return 0.95;
  if(/Stair/.test(ex)) return 0.80;
  return 1.00;
}

function compute(){
  const ex = document.getElementById("ex").value;
  const unit = document.getElementById("unit").value;
  const dist = +document.getElementById("dist").value||0;

  const reps = +document.getElementById("reps").value||0;
  const jpr  = +document.getElementById("jpr").value||0;

  const stepsCol = +document.getElementById("stepsCol").value||0;
  const cols     = +document.getElementById("cols").value||0;
  const jps      = +document.getElementById("jps").value||1;

  const sleep = +document.getElementById("sleep").value||0;
  const ach   = document.getElementById("ach").value;

  const avgHR = +document.getElementById("avgHR").value||0;
  const z5    = +document.getElementById("z5").value||0;

  // contacts
  let contacts = 0;
  if(unit === "Stadium Stairs"){
    contacts = stepsCol * cols * jps; // exact by architecture
  }else{
    contacts = reps * jpr;            // ground contacts
  }

  // tendon load index (contacts √ó impact √ó modifiers)
  let tendon = contacts * impactFactor(ex);
  if(ach==="Tight") tendon *= 1.10;
  if(ach==="Sore")  tendon *= 1.25;
  if(sleep<7)       tendon *= 1.10;

  // CNS load (0‚Äì100) ‚Äî conservative bounded model
  let cns = 35;
  cns += Math.min(30, impactFactor(ex)*contacts/120); // more contacts -> more load (slope ~impact)
  if(sleep<7) cns += 8;
  if(ach==="Sore") cns += 10;
  if(avgHR>=170) cns += 8;
  if(z5>=10) cns += 8;
  cns = Math.max(0, Math.min(100, Math.round(cns)));

  // UI
  document.getElementById("mContacts").textContent = Math.round(contacts);
  document.getElementById("mTendon").textContent   = Math.round(tendon);
  document.getElementById("mCNS").textContent      = cns;

  const risk = [];
  if(unit==="Stadium Stairs" && stepsCol*cols>300) risk.push("Very high stair volume. Consider splitting columns.");
  if(ach==="Sore") risk.push("Achilles/calf sore: avoid depth jumps and high-impact rebounds.");
  if(cns>=75) risk.push("High CNS day. Plan 48h before max sprint/ME lower.");
  const box = document.getElementById("riskBox");
  if(risk.length===0) box.innerHTML = `<div class="ok"><b>‚úì Good to go.</b> Manage landings, keep quality high, and respect rest intervals.</div>`;
  else box.innerHTML = `<div class="${cns>=85?'danger':'warn'}"><b>‚ö† Attention:</b><ul style="margin:8px 0 0 18px">${risk.map(x=>`<li>${x}</li>`).join("")}</ul></div>`;
}

function saveDay(k){
  // persist all inputs + recomputed metrics
  const grab = id => document.getElementById(id);
  const file = grab("hrImg").files?.[0];
  const save = (imgDataUrl="")=>{
    const obj = {
      ex:grab("ex").value, unit:grab("unit").value, dist:+grab("dist").value||0,
      reps:+grab("reps").value||0, jpr:+grab("jpr").value||0,
      stepsCol:+grab("stepsCol").value||0, cols:+grab("cols").value||0, jps:+grab("jps").value||1,
      sleep:+grab("sleep").value||0, ach:grab("ach").value,
      avgHR:+grab("avgHR").value||0, z5:+grab("z5").value||0,
      notes:grab("notes").value, img:imgDataUrl,

      // derived metrics (after compute())
      contacts:+document.getElementById("mContacts").textContent||0,
      tendon:+document.getElementById("mTendon").textContent||0,
      cns:+document.getElementById("mCNS").textContent||0
    };
    store[k] = store[k]||{};
    store[k].trackPlyo = obj;
    localStorage.setItem("eliteTrainingData", JSON.stringify(store));
    compute();
  };
  if(file){
    const rd = new FileReader();
    rd.onload = ()=>save(rd.result);
    rd.readAsDataURL(file);
  }else{
    save();
  }
}

/* =================== INIT ============================ */
function init(){
  setTitle(); draw();
}
window.addEventListener("load", init);
</script>
</body>
</html>
